{"name":"Whiskey","body":"Whiskey\r\n=======\r\n\r\nWhiskey is a powerful test runner for NodeJS applications.\r\n\r\nFeatures\r\n========\r\n\r\n* Each test file runs isolated in a separate process\r\n* Support for running multiple tests in parallel (`--concurrency` option)\r\n* Support for a test initialization function which is run before running the tests in a test file\r\n* Support for a test file timeout\r\n* setUp / tearDown function support\r\n* Support for different test reporters (cli, tap)\r\n* Support for code coverage (cli reporter, html reporter)\r\n* Support for reporting variables which have leaked into a global scope\r\n* Nicely formatted reports (colors!)\r\n* Integration with node debugger\r\n* Support for generating Makefiles with different Whiskey targets\r\n\r\nNon NPM-installable Dependencies\r\n===============================\r\n\r\n* [node-jscoverage](https://github.com/Kami/node-jscoverage) (only required if `--coverage` option is used)\r\n\r\nChanges\r\n=======\r\n\r\nFor changes please see [CHANGES.md](/cloudkick/whiskey/blob/master/CHANGES.md) file.\r\n\r\nInstallation\r\n============\r\n\r\nInstall it using npm:\r\n\r\n```\r\nnpm install whiskey\r\n```\r\n\r\nUsage\r\n=====\r\n\r\n    whiskey [options] --tests \"<test files>\"\r\n\r\n#### Available options\r\n\r\n * **-t, --tests** - Whitespace separated list of test files to run\r\n * **-ti, --test-init-file** - A path to the initialization file which must export\r\n `init` function and it is called in a child process *before running the tests in\r\n each test file\r\n * **-c, --chdir** - An optional path to which the child process will chdir to before\r\n running the tests\r\n * **--timeout [NUMBER]** - How long to wait for tests to complete before timing\r\n out\r\n * **--failfast** - Stop running the tests on a first failure or a timeout\r\n * **--no-styles** - Don't use styles and colors\r\n * **--concurrency [NUMBER]** - Maximum number of tests which will run in parallel (defaults to 1)\r\n * **--quiet** - Don't print stdout and stderr\r\n * **--real-time** - Print stdout and stderr as soon as it comes in\r\n * **--test-reporter [cli,tap]** - Which test reporter to use (defaults to cli)\r\n * **--coverage** - Use this option to enable the test coverage\r\n * **--coverage-reporter [cli,html]** - Which coverage reporter to use (defaults to cli)\r\n * **--coverage-dir** - Directory where the coverage HTML report is saved\r\n * **--scope-leaks** - Record which variables were leaked into a global scope\r\n * **--scope-leaks-reporter [cli]** - Which scope leak reporter to use (defaults\r\n   to cli)\r\n * **--debug** - Attach a Node debugger to the test process\r\n * **--report-timing** - Report each test run time\r\n * **--dependencies STRING** - Specify path to the dependencies file for the\r\n   process runner. More information about the process runner can be found at\r\n   [PROCESS_RUNNER.md](/cloudkick/whiskey/blob/master/PROCESS_RUNNER.md)\r\n * **--only-essential-dependencies** - Only start dependencies required by the tests\r\n   files which are ran. This option is only applicable if `--dependencies` option\r\n   is used.\r\n\r\nNote: When specifying multiple test a list with the test paths must be quoted,\r\nfor example: `whiskey --tests \"tests/a.js tests/b.js tests/c.js\"`\r\n\r\nTest File Examples\r\n==================\r\n\r\nA simple example (success):\r\n\r\n``` javascript\r\nvar called = 0;\r\n\r\nexports['test_async_one_equals_one'] = function(test, assert) {\r\n  setTimeout(function() {\r\n    assert.equal(1, 1);\r\n    called++;\r\n    test.finish();\r\n  }, 1000);\r\n}\r\n\r\nexports['tearDown'] = function(test, assert) {\r\n  assert.equal(called, 1);\r\n  test.finish();\r\n}\r\n```\r\n\r\nA simple example (skipping a test):\r\n\r\n``` javascript\r\nvar dbUp = false;\r\nexports['test_query'] = function(test, assert) {\r\n  if (!dbUp) {\r\n    test.skip('Database is not up, skipping...');\r\n    return;\r\n  }\r\n\r\n  assert.equal(2, 1);\r\n  test.finish();\r\n}\r\n```\r\n\r\n\r\nA simple example (failure):\r\n\r\n``` javascript\r\nexports['test_two_equals_one'] = function(test, assert) {\r\n  assert.equal(2, 1);\r\n  test.finish();\r\n}\r\n```\r\n\r\nFor more examples please check the `example/` folder.\r\n\r\nRunning Whiskey test suite\r\n==========================\r\n\r\nTo run the Whiskey test suite, run the following command in the repository root\r\ndirectory.\r\n\r\n`npm test`\r\n\r\nIf all the tests have sucessfully passed, the process should exit with a zero\r\nstatus code and you should see `* * * Whiskey test suite PASSED. * * *`\r\nmessage.\r\n\r\nContributing\r\n============\r\n\r\nTo contribute, fork the repository, create a branch with your changes and open a\r\npull request.\r\n\r\nDebugging\r\n=========\r\n\r\nIf you want to debug your test, you can use the `--debug` option. This will\r\ncause Whiskey to start the test process with the V8 debugger attached to it\r\nand put you into the Node debugger prompt.\r\n\r\nWhiskey will also by default set a breakpoint at the beginning of your test\r\nfile.\r\n\r\nNote: This option can only be used with a single test file.\r\n\r\nTroubleshooting\r\n===============\r\n\r\n### I use `long-stack-straces` module in my own code and all of the tests get reported as succeeded\r\n\r\nLong stack traces modules intercepts the default Error object and throws a custom\r\none. The problem with this is that Whiskey internally relies on attaching the\r\ntest name to the `Error` object so it can figure out to which test the exception\r\nbelongs. long-stack-traces throws a custom Error object and as a consequence test\r\nname attribute gets lost so Whiskey thinks your test didn't throw any exceptions.\r\n\r\nThe solution for this problem is to disable `long-stack-trace` module when running\r\nthe tests. This shouldn't be a big deal, because Whiskey internally already uses\r\n`long-stack-traces` module which means that you will still get long stack traces\r\nin the exceptions which were thrown in your tests.\r\n\r\n### My test gets reported as \"timeout\" instead of \"failure\"\r\n\r\nIf your test gets reported as \"timeout\" instead of \"failure\" your test code most\r\nlikely looks similar to the one below:\r\n\r\n```javascript\r\nexports[\"test failure\"] = function(test, assert){\r\n  setTimeout(function() {\r\n    throw \"blaaaaah\";\r\n    test.finish();\r\n  },200);\r\n};\r\n```\r\n\r\nThe problem with this is that if you run tests in parallel (`--concurrency` > 1)\r\nand you don't use a custom assert object which gets passed to each test function,\r\nWhiskey can't figure out to which test the exception belongs. As a consequence,\r\nthe test is reported as \"timed out\" and the exception is reported as \"uncaught\".\r\n\r\nThe solution for this problem is to run the tests in sequential mode (drop the\r\n--concurrency option).\r\n\r\nLicense\r\n=======\r\n\r\nApache 2.0, for more info see [LICENSE](/cloudkick/whiskey/blob/master/LICENSE).\r\n","tagline":"A powerful test runner for NodeJS applications.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}